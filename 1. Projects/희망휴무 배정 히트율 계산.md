### 개요
희망 휴무 배정 히트율 분석을 통해서 스케줄링이 얼마나 효율적으로 이루어지고 있는지 파악한다.
### 희망 휴무 범위 히트율
```sql
-- 희망휴무 범위 히트율  
SELECT  
    COUNT(*) AS 희망휴무_신청_전체_인원,  
    SUM(배정됨) AS 희망휴무_배정_인원,  
    SUM(배정_1순위) AS 희망휴무_1순위_배정_인원,  
    SUM(배정_2순위) AS 희망휴무_2순위_배정_인원,  
    ROUND((SUM(배정됨)::float / COUNT(*))::numeric, 2) AS 희망휴무_배정_인원_히트율,  
    ROUND((SUM(배정_1순위)::float / COUNT(*))::numeric, 2) AS 희망휴무_1순위_배정_인원_히트율,  
    ROUND((SUM(배정_2순위)::float / COUNT(*))::numeric, 2) AS 희망휴무_2순위_배정_인원_히트율  
FROM (  
    SELECT  
       r.delivery_manager_id,  
        CASE WHEN COUNT(s.day_of_week) > 0 THEN 1 ELSE 0 END AS 배정됨,  
        MAX(CASE WHEN  CAST(r.순위1 AS INTEGER) = s.day_of_week THEN 1 ELSE 0 END) as 배정_1순위,  
        MAX(CASE WHEN  CAST(r.순위2 AS INTEGER) = s.day_of_week THEN 1 ELSE 0 END) as 배정_2순위  
    FROM (  
        SELECT  
            delivery_manager_id,  
            NULLIF(SPLIT_PART(day_of_week, ',', 1), '') AS 순위1,  
            NULLIF(SPLIT_PART(day_of_week, ',', 2), '') AS 순위2,  
            CAST(NULLIF(unnest(string_to_array(day_of_week, ',')), '') AS INTEGER) AS day_of_week  
        FROM  
            require_day_off  
        WHERE  
            week_of_year BETWEEN '202322' AND '202328'  
    ) AS r  
    LEFT JOIN (  
        SELECT  
            delivery_manager_id,  
            CASE  
                WHEN EXTRACT(DOW FROM work_day) = 0 THEN 7  
                ELSE EXTRACT(DOW FROM work_day)  
            END AS day_of_week  
        FROM  
            delivery_manager_schedule  
        WHERE  
            work_type = 'OFF' AND "rule" NOT IN ('SYSTEM', 'ADMIN') AND work_day BETWEEN '2023-05-29' AND '2023-07-10'  
    ) AS s ON r.delivery_manager_id = s.delivery_manager_id AND s.day_of_week = r.day_of_week  
    GROUP BY r.delivery_manager_id  
) AS subquery;
```

### 쿼리 검증 시나리오
10명의 희망휴무 신청자가 있다는 가정.

- 10명의 SC 데이터 생성 (id: 10 ~ 20)
- 주차: 202340 (2023-10-02 ~ 2023-10-08)

id, 희망휴무 신청일자, 배정일, 순위
10, [수, 월], [수], [1순위]
11,  [월], X, X
12, [월, 화], [월, 화], [1순위, 2순위]
13, [일], [일], [1순위]
14, [목, 금], [금], [2순위]
15, [목, 금], [목], [1순위]
16, [금], [금], [1순위]
17, [수, 월], [수, 월], [1순위, 2순위]
18, [목, 토], [목], [1순위]
19, [토], X, X
20, [화, 수], [수], [2순위]


### 궁금
rule이 `SYSTEM`인 경우는 뭐지?
희망휴무랑 rule이 SYSTEM이고 work_type이 OFF인 경우랑 상관이 있는 케이스가 있을까?

쿼리 검증은 어떻게 해야하지? 엑셀에 VLOOKUP 함수 사용해서 비교해볼 수 있다?
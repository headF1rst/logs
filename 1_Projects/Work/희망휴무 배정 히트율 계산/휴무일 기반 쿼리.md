### 희망 휴무 범위 히트율
```sql
-- 희망휴무 범위 히트율  
SELECT  
    COUNT(*) AS 희망휴무_신청_전체_인원,  
    SUM(배정됨) AS 희망휴무_배정_인원,  
    SUM(배정_1순위) AS 희망휴무_1순위_배정_인원,  
    SUM(배정_2순위) AS 희망휴무_2순위_배정_인원,  
    ROUND((SUM(배정됨)::float / COUNT(*))::numeric, 2) AS 희망휴무_배정_인원_히트율,  
    ROUND((SUM(배정_1순위)::float / COUNT(*))::numeric, 2) AS 희망휴무_1순위_배정_인원_히트율,  
    ROUND((SUM(배정_2순위)::float / COUNT(*))::numeric, 2) AS 희망휴무_2순위_배정_인원_히트율  
FROM (  
    SELECT  
       r.delivery_manager_id,  
        CASE WHEN COUNT(s.day_of_week) > 0 THEN 1 ELSE 0 END AS 배정됨,  
        MAX(CASE WHEN  CAST(r.순위1 AS INTEGER) = s.day_of_week THEN 1 ELSE 0 END) as 배정_1순위,  
        MAX(CASE WHEN  CAST(r.순위2 AS INTEGER) = s.day_of_week THEN 1 ELSE 0 END) as 배정_2순위  
    FROM (  
        SELECT  
            delivery_manager_id,  
            NULLIF(SPLIT_PART(day_of_week, ',', 1), '') AS 순위1,  
            NULLIF(SPLIT_PART(day_of_week, ',', 2), '') AS 순위2,  
            CAST(NULLIF(unnest(string_to_array(day_of_week, ',')), '') AS INTEGER) AS day_of_week  
        FROM  
            require_day_off  
        WHERE  
            week_of_year BETWEEN '202322' AND '202328'  
    ) AS r  
    LEFT JOIN (  
        SELECT  
            delivery_manager_id,  
            CASE  
                WHEN EXTRACT(DOW FROM work_day) = 0 THEN 7  
                ELSE EXTRACT(DOW FROM work_day)  
            END AS day_of_week  
        FROM  
            delivery_manager_schedule  
        WHERE  
            work_type = 'OFF' AND "rule" NOT IN ('SYSTEM', 'ADMIN') AND work_day BETWEEN '2023-05-29' AND '2023-07-10'  
    ) AS s ON r.delivery_manager_id = s.delivery_manager_id AND s.day_of_week = r.day_of_week  
    GROUP BY r.delivery_manager_id  
) AS subquery;
```

휴무일 기반 쿼리의 경우, 희망휴무 신청 요일에 배정받지 못했지만, 하위 제약조건에 의해 배정받은 휴무일이 희망휴무 신청 요일과 우연히 일치해서 히트율이 실제 결과보다 높이 측정되는 경향이 있다. 

따라서 [[Rule 기반 쿼리]]로 진행하는것도 의미있어 보인다.
TOMS
### 작업 목표
- 전체 주소(기본 주소 + 상세 주소)로 저장되던 부분을 세분화하여 적재.
	- 기본 주소, 상세 주소 따로 적재되도록
- 각 API 호출 및 카프카 통신 시에도 전체 주소 대신 기본 주소 + 상세 주소로 나뉘어 통신할 수 있도록 변경한다.
### 작업 내용 파악

[[OMS]]에서 운영환경의 TOMS 회수, [[3PL]] 주문 [[topic]]을 특정 권역의 배송 CAPA 계산을 위한 집수 집계 목적으로 수신한다. (집계 데이터를 통해 3회차 마감 자동화 가능)

즉, SOMS가  **MSG-ORDER-OMS-ORDER_3PL**(주문 전송 + 회차), **MSG-ORDER-OMS-ORDER_RETRUN**(회수) [[topic]]을 바라보고 있다.
[UI for Apache Kafka](https://manager-kafka-prod.data.kurlycorp.kr/ui/clusters/prod-msk-wms-01/all-topics/MSG-ORDER-OMS-ORDER_3PL/consumer-groups)

현재 MSG-ORDER-OMS-ORDER_3PL(주문 전송 + 회차), MSG-ORDER-OMS-ORDER-RETRUN(회수) 토픽에서 주소와 상세 주소를 하나의 필드(`address`)로 병합하여 보내고 있다.

#Q 기본 주소 = `address`, 상세 주소 = `addressDetail` ?
-> `address` 는 상세 주소 포함된 전체 주소. 따라서 `address`에서 기본 주소(`addressBasic?`), 상세 주소(`addressDetail`)로 분리해서 저장하면 될듯.

기본 주소 컬럼명 고려 (addressBasic?, defaultAddress?) - 테이블 컬럼 추가 작업 필요 예상.

![[스크린샷 2023-10-06 오후 5.15.07.png]]

주소와 상세 주소를 나눠서 토픽 발행해야한다. 단, OMS의 자동화에 영향이 가지 않기 위해서는 기존의 전체주소도 같이 보내줘야한다.
### 해야할것

- 카프카로 `주문 전송`할 때 `전체 주소`로 보내는 부분을 `기본 주소`, `상세 주소`로 나눠서 보내야 한다.
	- `주문 등록` 시점부터 TOMS DB나 어플리케이션 로직을 수정해야 할 수도 있다.
	- `주소 정제` API 호출할 때도 `기본 주소`, `상세 주소`로 나뉘어서 보내는지 확인이 필요하다 -> 나눠서 안보냄.

[[topic]] 발행 시점 파악 필요.
주문 전송 & 주문 등록시에 카프카로 토픽 발행하는 로직을 찾아봐야겠다.
이 로직에서 `전체 주소`로 보내는 부분 확인할 수 있을듯?




- [[TC주문 등록 엑셀 업로드]] (`POST api/tcorders/add/excel/upload`)
- [[주소 정제]] (`POST api/tcorders/receivers/refine`)
- [[TC 주문 전송]] (`PUT api/tcorders/send`)

#Q 전체 주소는 현재 어느 테이블에 적재되고 있지?
-> `Receiver` 테이블에 수령자 주소에 관한 데이터가 적재되고 있다.

### 작업 티켓
https://kurly0521.atlassian.net/browse/DPDT-7169

### 참고 자료
- [TOMS 주문/회수 전송 스키마](https://kurly0521.atlassian.net/wiki/spaces/DPD/pages/3721528406/TOMS)
작업배경
- https://marketkurly.slack.com/archives/C04KGD3PMHB/p1691631330762399
- https://marketkurly.slack.com/archives/C04KGD3PMHB/p1690533067607289?thread_ts=1689230561.572679&cid=C04KGD3PMHB

#Q 택배대행은 뭐지? 배송대행이랑 뭐가 다른걸까
-> [[3P]]랑 [[3PL]]의 차이인가?

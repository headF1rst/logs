#papercut #Database 

하나의 트랜잭션은 하나의 Connection을 가져와 사용하다가 닫는 사이에 일어난다.
트랜잭션 시작과 종료는 Connection 객체를 통해서 이루어진다.

Spring은 `@Transactional` 을 통해 선언적 트랜잭션을 제공하며 여러 논리적 트랜잭션을 묶어서 하나의 큰 트랜잭션 경계를 생성할 수 있다.

**논리 트랜잭션**: Spring 트랜잭션 매니저를 통해 트랜잭션을 처리하는 단위. 트랜잭션 전파 속성에 따라서 외부 트랜잭션과 내부 트랜잭션이 동일한 물리 트랜잭션을 사용할 수 있다.

**물리 트랜잭션**: 실제 DB에서 Connection 객체를 통해 제공하는 트랜잭션. 최종적으로 물리 트랜잭션이 종료되야 트랜잭션이 끝난다.

- 모든 논리 트랜잭션이 커밋되어야 물리 트랜잭션이 커밋된다.
- 하나의 논리 트랜잭션이라도 롤백되면 물리 트랜잭션은 롤백된다.
### REQUIRED

![[스크린샷 2023-10-31 오후 10.42.00.png]]

디폴트 전파 속성으로 내부 트랜잭션은 기존에 존재하는 외부 트랜잭션에 참여하여 하나의 물리 트랜잭션으로 이어간다.

내부 트랜잭션이 커밋되더라도 즉시 커밋되지는 않고, 외부 트랜잭션이 최종적으로 커밋되는 시점에 실제로 커밋이 이루어진다.
### REQUIRES_NEW

![[스크린샷 2023-10-31 오후 10.42.29.png]]

2개의 물리 트랜잭션이 사용되며, 각 트랜잭션 별로 커밋과 롤백이 독립적으로 수행된다. 즉, 내부 트랜잭션 롤백이 외부 트랜잭션 롤백에 영향을 주지 않는다.

HTTP 요청 하나에 대해 2개의 커넥션이 사용된다. 내부 트랜잭션이 처리 중일때 꺼내진 외부 트랜잭션이 대기하는데, DB 커넥션을 고갈시키는 원인이 될 수 있다.
### 그 외 트랜잭션 전파 속성

![[스크린샷 2023-10-31 오후 10.45.46.png]]



https://mangkyu.tistory.com/269